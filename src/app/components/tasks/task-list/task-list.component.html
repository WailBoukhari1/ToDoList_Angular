<div class="task-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Tasks</mat-card-title>
      <mat-card-subtitle>Manage your tasks</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <app-task-search></app-task-search>

      <div class="action-bar">
        <button mat-raised-button color="primary" routerLink="/tasks/new">
          <mat-icon>add</mat-icon>
          New Task
        </button>
      </div>
      
      <table mat-table [dataSource]="(tasks$ | async) ?? []" class="mat-elevation-z2">
        <!-- Title Column -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Title</th>
          <td mat-cell *matCellDef="let task">{{ task.title }}</td>
        </ng-container>

        <!-- Due Date Column -->
        <ng-container matColumnDef="dueDate">
          <th mat-header-cell *matHeaderCellDef>Due Date</th>
          <td mat-cell *matCellDef="let task">{{ task.dueDate | date:'medium' }}</td>
        </ng-container>

        <!-- Priority Column -->
        <ng-container matColumnDef="priority">
          <th mat-header-cell *matHeaderCellDef>Priority</th>
          <td mat-cell *matCellDef="let task">
            <mat-chip [color]="getPriorityColor(task.priority)" selected>
              {{ task.priority }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let task">
            <mat-chip [color]="getStatusColor(task.status)" selected>
              {{ task.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Category Column -->
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let task">
            @if (task.category) {
              <span class="category-chip">{{ task.category.name }}</span>
            }
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let task">
            <button mat-icon-button color="primary" [routerLink]="['/tasks', task.id, 'edit']">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteTask(task)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      @if ((tasks$ | async)?.length === 0) {
        <div class="empty-state">
          <mat-icon>assignment</mat-icon>
          <p>No tasks found</p>
          <button mat-stroked-button color="primary" routerLink="/tasks/new">
            Create your first task
          </button>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
